# MCP Toolbox for Database Configuration for CareFlow Pulse
# Defines Firestore data source and patient management tools

sources:
  careflow-firestore:
    kind: "firestore"
    project: "careflow-478811"  # Google cloud project ID
    database: "careflow-db"  # Firestore database ID

tools:
  # Get all patients from the database
  get_all_patients:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve all patients from the database with their complete information"
    collectionPath: "patients"
    orderBy:
      field: "id"
      direction: "ASCENDING"
    limit: 100
  
  # Get patients with critical risk level
  get_critical_patients:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve all patients with critical (RED) risk level requiring urgent attention"
    collectionPath: "patients"
    filters: |
      {
        "field": "riskLevel",
        "op": "==",
        "value": {"stringValue": "RED"}
      }
    orderBy:
      field: "id"
      direction: "ASCENDING"
  
  # Get patients by risk level (parameterized)
  get_patients_by_risk_level:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve patients filtered by their risk level (RED, YELLOW, GREEN)"
    collectionPath: "patients"
    filters: |
      {
        "field": "riskLevel",
        "op": "==",
        "value": {"stringValue": "{{.riskLevel}}"}
      }
    parameters:
      - name: riskLevel
        type: string
        description: "Risk level to filter by (RED, YELLOW, or GREEN)"
        required: true
  
  # Get patients for specific medication schedule (morning/noon/evening)
  get_patients_for_schedule:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve all active patients (filter by scheduleHour client-side since Firestore doesn't store this field yet)"
    collectionPath: "patients"
    filters: |
      {
        "field": "status",
        "op": "==",
        "value": {"stringValue": "active"}
      }
    limit: 100
  
  # Get specific patient by ID using query
  get_patient_by_id:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve detailed information for a specific patient by their ID"
    collectionPath: "patients"
    filters: |
      {
        "field": "id",
        "op": "==",
        "value": {"stringValue": "{{.patientId}}"}
      }
    parameters:
      - name: patientId
        type: string
        description: "The unique identifier of the patient (the id field value)"
        required: true
  
  # Query patients by diagnosis
  query_patients_by_diagnosis:
    kind: firestore-query
    source: careflow-firestore
    description: "Find all patients with a specific diagnosis"
    collectionPath: "patients"
    filters: |
      {
        "field": "diagnosis",
        "op": "==",
        "value": {"stringValue": "{{.diagnosis}}"}
      }
    parameters:
      - name: diagnosis
        type: string
        description: "The diagnosis to search for"
        required: true

  # Query patient by phone number (for inbound calls)
  get_patient_by_phone:
    kind: firestore-query
    source: careflow-firestore
    description: "Find a patient by their phone number (for inbound call identification)"
    collectionPath: "patients"
    filters: |
      {
        "field": "contact.phone",
        "op": "==",
        "value": {"stringValue": "{{.phoneNumber}}"}
      }
    parameters:
      - name: phoneNumber
        type: string
        description: "Patient's phone number in E.164 format (e.g., +15551234567)"
        required: true

  # List all available collections
  list_collections:
    kind: firestore-list-collections
    source: careflow-firestore
    description: "List all available collections in the Firestore database"

  # Create a new critical alert
  create_alert:
    kind: firestore-add-documents
    source: careflow-firestore
    description: >
      Create a new critical alert. 
      REQUIRED: 
      1. collectionPath: "alerts"
      2. documentData: A JSON object where keys are fields (patientId, priority, etc.) and values are Firestore-typed (e.g., {"stringValue": "RED"}).
      Example documentData:
      {
        "patientId": {"stringValue": "ID_HERE"},
        "priority": {"stringValue": "critical"},
        "trigger": {"stringValue": "Pain 8/10"},
        "status": {"stringValue": "active"},
        "createdAt": {"stringValue": "2023-10-10T10:00:00Z"}
      }

  # Update patient risk level
  update_patient_risk:
    kind: firestore-update-document
    source: careflow-firestore
    description: >
      Update a patient's risk level.
      REQUIRED:
      1. documentPath: "patients/{patientId}"
      2. documentData: Firestore-typed fields to update.
      3. updateMask: List of fields to update (e.g. ["riskLevel", "lastAssessment"])

  # Log interaction
  log_patient_interaction:
    kind: firestore-add-documents
    source: careflow-firestore
    description: "Log a call interaction. collectionPath='patients/{id}/interactions'. documentData must include content, type, sender, timestamp."

toolsets:
  patient_tools:
    - get_all_patients
    - get_critical_patients
    - get_patients_by_risk_level
    - get_patients_for_schedule
    - get_patient_by_id
    - get_patient_by_phone
    - query_patients_by_diagnosis
    - list_collections
    - create_alert
    - update_patient_risk
    - log_patient_interaction
