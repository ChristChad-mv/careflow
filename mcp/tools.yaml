# MCP Toolbox for Database Configuration for CareFlow Pulse
# Defines Firestore data source and patient management tools

sources:
  careflow-firestore:
    kind: "firestore"
    project: "careflow-478811"  # Google cloud project ID
    database: "careflow-db"  # Firestore database ID

tools:
  # Get patients for specific medication schedule
  get_patients_for_schedule:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve all active patients for the hospital"
    collectionPath: "patients"
    filters: |
      {
        "compositeFilter": {
          "op": "AND",
          "filters": [
            {
              "fieldFilter": {
                "field": "hospitalId",
                "op": "==",
                "value": {"stringValue": "{{.hospitalId}}"}
              }
            },
            {
              "fieldFilter": {
                "field": "status",
                "op": "==",
                "value": {"stringValue": "active"}
              }
            }
          ]
        }
      }
    limit: 100
    parameters:
      - name: hospitalId
        type: string
        description: "The Hospital ID to filter by"
        required: true
  
  # Get specific patient by ID using query
  get_patient_by_id:
    kind: firestore-query
    source: careflow-firestore
    description: "Retrieve detailed information for a specific patient by their ID"
    collectionPath: "patients"
    filters: |
      {
        "compositeFilter": {
          "op": "AND",
          "filters": [
            {
              "fieldFilter": {
                "field": "hospitalId",
                "op": "==",
                "value": {"stringValue": "{{.hospitalId}}"}
              }
            },
            {
              "fieldFilter": {
                "field": "id",
                "op": "==",
                "value": {"stringValue": "{{.patientId}}"}
              }
            }
          ]
        }
      }
    parameters:
      - name: hospitalId
        type: string
        description: "The Hospital ID to filter by"
        required: true
      - name: patientId
        type: string
        description: "The unique identifier of the patient"
        required: true
  
  # Query patient by phone number
  get_patient_by_phone:
    kind: firestore-query
    source: careflow-firestore
    description: "Find a patient by their phone number for the hospital"
    collectionPath: "patients"
    filters: |
      {
        "compositeFilter": {
          "op": "AND",
          "filters": [
            {
              "fieldFilter": {
                "field": "hospitalId",
                "op": "==",
                "value": {"stringValue": "{{.hospitalId}}"}
              }
            },
            {
              "fieldFilter": {
                "field": "contact.phone",
                "op": "==",
                "value": {"stringValue": "{{.phoneNumber}}"}
              }
            }
          ]
        }
      }
    parameters:
      - name: hospitalId
        type: string
        description: "The Hospital ID to filter by"
        required: true
      - name: phoneNumber
        type: string
        description: "Patient's phone number"
        required: true

  # Create a new critical alert
  create_alert:
    kind: firestore-add-documents
    source: careflow-firestore
    description: >
      Create a new critical alert. 
      REQUIRED: 
      1. collectionPath: "alerts"
      2. documentData: Must include hospitalId.
      Example:
      {
        "hospitalId": {"stringValue": "HOSP001"},
        "patientId": {"stringValue": "ID_HERE"},
        "priority": {"stringValue": "critical"}
      }

  # Update patient risk level
  update_patient_risk:
    kind: firestore-update-document
    source: careflow-firestore
    description: "Update a patient's risk level. Requires full document path."

  # Log interaction
  log_patient_interaction:
    kind: firestore-add-documents
    source: careflow-firestore
    description: "Log a call interaction. collectionPath='patients/{id}/interactions'."

toolsets:
  patient_tools:
    - get_patients_for_schedule
    - get_patient_by_id
    - get_patient_by_phone
    - create_alert
    - update_patient_risk
    - log_patient_interaction
